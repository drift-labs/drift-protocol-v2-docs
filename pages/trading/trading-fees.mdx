import { useData } from "nextra/data";

export const getStaticProps = async ({ params }) => {
  const perpFeeAdjustmentData = await fetch(
    `https://mainnet-beta.api.drift.trade/stats/perpMarketAccounts`
  )
    .then((res) => res.json())
    .then((repo) => {
      const adjustedFeePerpMarkets = repo.result.filter(
        (perpMarket) => perpMarket.feeAdjustment !== 0
      );

      return {
        perpFeeAdjustmentData: adjustedFeePerpMarkets.map((perpMarket) => [
        perpMarket.name
          .map((charCode) => String.fromCharCode(charCode))
          .join("")
          .trim(),
        (perpMarket.feeAdjustment > 0 ? '+':'') + perpMarket.feeAdjustment + "%" + (perpMarket.feeAdjustment > 0 ? ' (premium)' : ' (discount)'),
      ])};
    });

const spotFeeAdjustmentData = await fetch(
`https://mainnet-beta.api.drift.trade/stats/spotMarketAccounts`
)
.then((res) => res.json())
.then((repo) => {
const adjustedFeeSpotMarkets = repo.result.filter(
(spotMarket) => spotMarket.feeAdjustment !== 0
);

      return {
        spotFeeAdjustmentData: adjustedFeeSpotMarkets.map((spotMarket) => [
        spotMarket.name
          .map((charCode) => String.fromCharCode(charCode))
          .join("")
          .trim(),
          (spotMarket.feeAdjustment > 0 ? '+':'') + spotMarket.feeAdjustment + "%" + (spotMarket.feeAdjustment > 0 ? ' (premium)' : ' (discount)'),
      ])};
    });

const feeStructureResult = await fetch(
`https://mainnet-beta.api.drift.trade/stats/feeStructure`
)
.then((res) => res.json())
.then((repo) => {
const responseData = repo.result;
console.log({ responseData });
const perpFeeTiers = responseData.perpFeeStructure.feeTiers.filter(
(feeTier) => feeTier.makerRebateNumerator !== 0
);
const spotFeeTiers = responseData.spotFeeStructure.feeTiers.filter(
(feeTier) => feeTier.makerRebateNumerator !== 0
);
// FEE TIER CUTOFFS
const feeTiers = [
{
tier: 1,
volume: 0,
driftStaked: 0,
},
{
tier: 2,
volume: 2 + "M",
driftStaked: 1 + "K",
},
{
tier: 3,
volume: 10 + "M",
driftStaked: 10 + "K",
},
{
tier: 4,
volume: 20 + "M",
driftStaked: 25 + "K",
},
{
tier: 5,
volume: 80 + "M",
driftStaked: 100 + "K",
},
{
tier: "VIP",
volume: 200 + "M",
driftStaked: 120 + "K",
},
];

      // PERP FEE STRUCTURE

      const perpFeeStructureData = perpFeeTiers.map((feeTier, index) => {
        return [
          index + 1,
          Math.round(
            '-' + (feeTier.makerRebateNumerator / feeTier.makerRebateDenominator) *
              1e4
          ) + " bps",
          Math.round((feeTier.feeNumerator / feeTier.feeDenominator) * 1e4) +
            " bps",
          Math.round(
            (feeTier.refereeFeeNumerator / feeTier.refereeFeeDenominator) * 100
          ) + "%",
          Math.round(
            (feeTier.referrerRewardNumerator /
              feeTier.referrerRewardDenominator) *
              100
          ) + "%",
          Math.round(
            (responseData.perpFeeStructure.fillerRewardStructure
              .rewardNumerator /
              responseData.perpFeeStructure.fillerRewardStructure
                .rewardDenominator) *
              100
          ) + "%",
        ];
      });

      perpFeeStructureData[perpFeeStructureData.length - 1][0] = "VIP";

      // SPOT FEE STRUCTURE

      const spotFeeStructureData = spotFeeTiers.map((feeTier, index) => {
        return [
          index + 1,
          Math.round(
            '-' + (feeTier.makerRebateNumerator / feeTier.makerRebateDenominator) *
              1e4
          ) + " bps",
          Math.round((feeTier.feeNumerator / feeTier.feeDenominator) * 1e4) +
            " bps",
          Math.round(
            (feeTier.refereeFeeNumerator / feeTier.refereeFeeDenominator) * 100
          ) + "%",
          Math.round(
            (feeTier.referrerRewardNumerator /
              feeTier.referrerRewardDenominator) *
              100
          ) + "%",
          Math.round(
            (responseData.spotFeeStructure.fillerRewardStructure
              .rewardNumerator /
              responseData.spotFeeStructure.fillerRewardStructure
                .rewardDenominator) *
              100
          ) + "%",
        ];
      });

      if (spotFeeStructureData.length > 1) {
        spotFeeStructureData[spotFeeStructureData.length - 1][0] = "VIP";
      }

      return {
        perpFeeStructureData,
        spotFeeStructureData,
        feeTiers,
      };
    });

return {
props: {
ssg: {
...spotFeeAdjustmentData,
...perpFeeAdjustmentData,
...feeStructureResult,
},
// The page will be considered as stale and regenerated every 60 seconds.
revalidate: 60,
},
};
};

export const PerpFeeStructureTable = () => {
  // Get the data from SSG, and render it as a component.
  
  const headings = [
       "Tier",
       "Maker Fee",
       "Taker Fee",
       "Referree Taker Discount",
       "Referrer Reward",
       "Filler Reward",
      ];

const { perpFeeStructureData } = useData();

return <table>

  <thead>
    <tr>
      <>
        {headings.map((heading) => (
          <th key={heading}>{heading}</th>
        ))}
      </>
    </tr>
  </thead>
  <tbody>
    {perpFeeStructureData.map((row, i) => {
      return (
        <tr key={i}>
          {row.map((cell, j) => {
            return <td key={j}>{cell}</td>;
          })}
        </tr>
      );
    })}
  </tbody>
</table>
};

export const SpotFeeStructureTable = () => {
  // Get the data from SSG, and render it as a component.
  
  const headings = [
       "Tier",
       "Maker Fee",
       "Taker Fee",
       "Referree Taker Discount",
       "Referrer Reward",
       "Filler Reward",
      ];

const { spotFeeStructureData } = useData();

return <table>

  <thead>
    <tr>
      <>
        {headings.map((heading) => (
          <th key={heading}>{heading}</th>
        ))}
      </>
    </tr>
  </thead>
  <tbody>
    {spotFeeStructureData.map((row, i) => {
      return (
        <tr key={i}>
          {row.map((cell, j) => {
            return <td key={j}>{cell}</td>;
          })}
        </tr>
      );
    })}
  </tbody>
</table>

};

export const FeeTiersTable = () => {
  // Get the data from SSG, and render it as a component.
  
  const headings = [
       "Tier",
       "Required 30D Volume",
      ];

const { feeTiers } = useData();

return <table>

  <thead>
    <tr>
      <>
        {headings.map((heading) => (
          <th key={heading}>{heading}</th>
        ))}
      </>
    </tr>
  </thead>
  <tbody>
    {feeTiers.map((row, i) => {
      return (
        <tr key={i}>
          <>
            <td key={`${i}_0`}>{row.tier}</td>
            <td key={`${i}_2`}>{row.volume}</td>
          </>
        </tr>
      );
    })}
  </tbody>
</table>

};

export const AdjustedPerpMarketFeesTable = () => {
  // Get the data from SSG, and render it as a component.
  
  const headings = [
       "Market",
       "Fee Adjustment",
      ];

const { perpFeeAdjustmentData } = useData();

return <table>

  <thead>
    <tr>
      <>
        {headings.map((heading) => (
          <th key={heading}>{heading}</th>
        ))}
      </>
    </tr>
  </thead>
  <tbody>
    {perpFeeAdjustmentData.map((row, i) => {
      return (
        <tr key={i}>
          {row.map((cell, j) => {
            return <td key={j}>{cell}</td>;
          })}
        </tr>
      );
    })}
  </tbody>
</table>

};

export const AdjusteSpotMarketFeesTable = () => {
  // Get the data from SSG, and render it as a component.
  
  const headings = [
       "Market",
       "Fee Adjustment",
      ];

const { spotFeeAdjustmentData } = useData();

return <table>

  <thead>
    <tr>
      <>
        {headings.map((heading) => (
          <th key={heading}>{heading}</th>
        ))}
      </>
    </tr>
  </thead>
  <tbody>
    {spotFeeAdjustmentData.map((row, i) => {
      return (
        <tr key={i}>
          {row.map((cell, j) => {
            return <td key={j}>{cell}</td>;
          })}
        </tr>
      );
    })}
  </tbody>
</table>

};

# Trading Fees

Drift offers a highly competitive fee structure with low taker fees and attractive maker rebates across all tiers, with the potential for even lower fees as trading volume increases. Fees are calculated per trade based on the filled notional position size and are charged in the market's quote asset (USDC), affecting the position's cost basis.

If a user holds only non-USDC assets, a USDC borrow may be triggered upon settlement of a loss in perpetual markets (see [P&L](/profit-loss/profit-loss-intro)).

Drift's tiered fees for futures markets are based on an on-chain calculation of **30-Day Volume**. You can earn discounts on taker fees and extra rebates on maker fees by staking
DRIFT. These apply *on top* of your volume tier.

## Perp Market Fees

<div style={{ marginTop: '1.5em', overflowX: 'auto' }}>
  <style>
    {`
      table.fees th, table.fees td {
        border: 1px solid #e5e7eb;
        padding: 8px 6px;
        text-align: right;
        font-variant-numeric: tabular-nums;
      }
      table.fees th {
        background: #f5f7fa;
        color: #1a2233;
        text-align: center;
        font-weight: 600;
        font-size: 0.95em;
        white-space: nowrap;
      }
      table.fees tr:nth-child(even) { background: #f9f9fb; }
      table.fees td:first-child, table.fees th:first-child {
        text-align: left;
        white-space: nowrap;
      }
    `}
  </style>
<table class="fees">
  <thead>
    <tr>
      <th>Tier</th>
      <th>Rookie Taker</th>
      <th>Rookie Maker</th>
      <th>Kickstarter Taker</th>
      <th>Kickstarter Maker</th>
      <th>Racer Taker</th>
      <th>Racer Maker</th>
      <th>Elite Taker</th>
      <th>Elite Maker</th>
      <th>Master Taker</th>
      <th>Master Maker</th>
      <th>Champion Taker</th>
      <th>Champion Maker</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>â‰¤ $2M</td>
      <td>0.0350%</td>
      <td>-0.0025%</td>
      <td>0.0333%</td>
      <td>-0.0026%</td>
      <td>0.0315%</td>
      <td>-0.0028%</td>
      <td>0.0280%</td>
      <td>-0.0030%</td>
      <td>0.0245%</td>
      <td>-0.0033%</td>
      <td>0.0210%</td>
      <td>-0.0035%</td>
    </tr>
    <tr>
      <td>&gt; $2M</td>
      <td>0.0300%</td>
      <td>-0.0025%</td>
      <td>0.0285%</td>
      <td>-0.0026%</td>
      <td>0.0270%</td>
      <td>-0.0028%</td>
      <td>0.0240%</td>
      <td>-0.0030%</td>
      <td>0.0210%</td>
      <td>-0.0033%</td>
      <td>0.0180%</td>
      <td>-0.0035%</td>
    </tr>
    <tr>
      <td>&gt; $10M</td>
      <td>0.0275%</td>
      <td>-0.0025%</td>
      <td>0.0261%</td>
      <td>-0.0026%</td>
      <td>0.0248%</td>
      <td>-0.0028%</td>
      <td>0.0220%</td>
      <td>-0.0030%</td>
      <td>0.0193%</td>
      <td>-0.0033%</td>
      <td>0.0165%</td>
      <td>-0.0035%</td>
    </tr>
    <tr>
      <td>&gt; $20M</td>
      <td>0.0250%</td>
      <td>-0.0025%</td>
      <td>0.0238%</td>
      <td>-0.0026%</td>
      <td>0.0225%</td>
      <td>-0.0028%</td>
      <td>0.0200%</td>
      <td>-0.0030%</td>
      <td>0.0175%</td>
      <td>-0.0033%</td>
      <td>0.0150%</td>
      <td>-0.0035%</td>
    </tr>
    <tr>
      <td>&gt; $80M</td>
      <td>0.0225%</td>
      <td>-0.0025%</td>
      <td>0.0214%</td>
      <td>-0.0026%</td>
      <td>0.0203%</td>
      <td>-0.0028%</td>
      <td>0.0180%</td>
      <td>-0.0030%</td>
      <td>0.0158%</td>
      <td>-0.0033%</td>
      <td>0.0135%</td>
      <td>-0.0035%</td>
    </tr>
    <tr>
      <td>&gt; $200M (VIP)</td>
      <td>0.0200%</td>
      <td>-0.0025%</td>
      <td>0.0190%</td>
      <td>-0.0026%</td>
      <td>0.0180%</td>
      <td>-0.0028%</td>
      <td>0.0160%</td>
      <td>-0.0030%</td>
      <td>0.0140%</td>
      <td>-0.0033%</td>
      <td>0.0120%</td>
      <td>-0.0035%</td>
    </tr>
  </tbody>
</table>
</div>

### Fee Benefits via DRIFT Staking
Earn **additional discounts on taker fees** and **extra rebates on maker fees** by staking DRIFT.
These stack on top of your volume tier. These benefits only apply to perp fees.

<div style={{ marginTop: '1.5em', overflowX: 'auto' }}>
<table class="fees">
  <thead>
    <tr>
      <th>Tier</th>
      <th>DRIFT Staked</th>
      <th>Taker Fee Discount</th>
      <th>Maker Fee Rebate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Rookie</td>
      <td>0</td>
      <td>0%</td>
      <td>0%</td>
    </tr>
    <tr>
      <td>Kickstarter</td>
      <td>1,000</td>
      <td>â€“5%</td>
      <td>+5%</td>
    </tr>
    <tr>
      <td>Racer</td>
      <td>10,000</td>
      <td>â€“10%</td>
      <td>+10%</td>
    </tr>
    <tr>
      <td>Elite</td>
      <td>50,000</td>
      <td>â€“20%</td>
      <td>+20%</td>
    </tr>
    <tr>
      <td>Master</td>
      <td>100,000</td>
      <td>â€“30%</td>
      <td>+30%</td>
    </tr>
    <tr>
      <td>Champion</td>
      <td>250,000</td>
      <td>â€“40%</td>
      <td>+40%</td>
    </tr>
  </tbody>
</table>
</div>


**Examples:**  
- *A Tier 3 taker (0.0275%) with 20% staking discount pays 0.022% effective fee.*  
- *A maker (â€“0.0025% rebate) with 20% staking gets â€“0.003% rebate.*

## Spot Market Fees

<SpotFeeStructureTable />

## Fee-Adjusted Markets

_Some markets offer additional discounts, these are part of a temporary
campaign, and be will subject to change in the future._

### Perp Markets

<AdjustedPerpMarketFeesTable />

### Spot Markets

<AdjusteSpotMarketFeesTable />

---

### Drift staking benefits

The fee benefits via DRIFT staking only apply to perpetual contract fees.

### Taker Fees (High Leverage Mode)

If a user has High Leverage Mode turned on, taker trading fees for all perp markets will be 2x the bottom fee tier.

### Referee Discount / Referer Reward

These apply to accounts that were signed up using a referred account. These percentages are applied to the effective taker fee paid.

### Filler Reward

Filler rewards are variable but up to 10% of the effective taker fee paid by the user. See [Keeper Incentives](/about-v2/keeper-incentives).

### Fee Adjustments

Longer tail assets can have increased fees to stay in line with external markets fee schedules. Some markets will periodically have flat discounts applied to all fee tiers. [See Fee-Adjusted Markets](#fee-adjusted-markets)

### Disclaimers

_Drift Protocol reserves the right to end the promotional period and the Taker Incentive Program at any time. If the Drift Protocol chooses to do so, it will provide notice to participating users, but such notice is not required in order to conclude the program early or extend the program. Please note that the terms and conditions of this program are subject to change without notice._

_There are risks associated with Insurance Fund Staking. Read more about the [Insurance Fund Staking](/insurance-fund/insurance-fund-staking) and [Risks](/security/risks))._\*\*
