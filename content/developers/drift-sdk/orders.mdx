# Orders

## How it works

Orders on Drift go through a multi-stage matching process. When you place an order, it enters a **JIT auction** (Just-In-Time) where market makers can compete to fill it at better prices. If no one fills during the auction, the order either executes against the **DLOB** (Decentralized Limit Order Book) or the **AMM** as a fallback. This design ensures you get the best price from multiple liquidity sources.

Drift supports several order types: **market** (immediate execution), **limit** (rests on the orderbook at a specific price), **oracle** (price pegged to oracle with an offset), and **trigger** orders (conditional execution when a price threshold is hit). Each order has parameters like size, price, post-only flags, and reduce-only settings that control how it behaves.

Orders are stored in your user account and have both an onchain order ID and an optional user-assigned ID for tracking. When an order fills, your position updates automatically, and you can query fill events to see execution details.

## SDK Usage

This page focuses on placing and canceling orders via `DriftClient`. For concise examples we use helper builders like `getMarketOrderParams(...)`.

### Build Market Order Params

<SDKDoc>
  <TypeScript name="getMarketOrderParams" type="function">
```js
import { BN, BASE_PRECISION, MarketType, PositionDirection, getMarketOrderParams } from "@drift-labs/sdk";

const orderParams = getMarketOrderParams({
  marketIndex: 0,
  marketType: MarketType.PERP,
  direction: PositionDirection.LONG,
  baseAssetAmount: new BN(1).mul(BASE_PRECISION), // 1 SOL (in 1e9 precision)
});
```
  </TypeScript>
</SDKDoc>

### Build Order Params (Generic Helper)

If you want a single helper that works for limit/market/oracle/trigger, use `getOrderParams(...)`.

<SDKDoc>
  <TypeScript name="getOrderParams" type="function">
```js
import { getOrderParams, OrderType, PositionDirection } from "@drift-labs/sdk";

const orderParams = getOrderParams({
  orderType: OrderType.LIMIT,
  marketIndex: 0,
  direction: PositionDirection.LONG,
  baseAssetAmount: driftClient.convertToPerpPrecision(1),   // 1 base unit → BN(1e9)
  price: driftClient.convertToPricePrecision(21.23),         // $21.23 → BN(21_230_000)
});
```
  </TypeScript>
</SDKDoc>

### Place a Perp Order

<SDKDoc>
  <TypeScript name="placePerpOrder" type="method" owner="DriftClient">
```js
// Assumes `driftClient` is subscribed.
const txSig = await driftClient.placePerpOrder(
  getMarketOrderParams({
    marketIndex: 0,
    direction: PositionDirection.LONG,
    baseAssetAmount: new BN(1).mul(BASE_PRECISION),
  })
);
console.log(txSig);
```
  </TypeScript>
</SDKDoc>

### Oracle / Auction-Style Orders

Oracle orders have prices that track the oracle feed with an offset. They go through a JIT auction before execution, with auction prices that gradually converge from the start offset to the end offset relative to oracle.

**Important:** For `OrderType.ORACLE`, `auctionStartPrice`, `auctionEndPrice`, and `oraclePriceOffset` are all **offsets** from the oracle price (in PRICE_PRECISION, 1e6), not absolute prices.

```js
import { BN, OrderType, PositionDirection, PRICE_PRECISION } from "@drift-labs/sdk";

const marketIndex = 18;

// Offsets are relative to oracle price (in PRICE_PRECISION)
// For a long: auction starts at a better (lower) price and ends at a worse (higher) price
const auctionStartPrice = PRICE_PRECISION.muln(-5).divn(10); // -$0.50 below oracle
const auctionEndPrice = PRICE_PRECISION.muln(5).divn(10);    // +$0.50 above oracle

const orderParams = {
  orderType: OrderType.ORACLE,
  baseAssetAmount: driftClient.convertToPerpPrecision(10),
  direction: PositionDirection.LONG,
  marketIndex,
  auctionStartPrice,
  auctionEndPrice,
  oraclePriceOffset: driftClient.convertToPricePrecision(0.30).toNumber(), // +$0.30 from oracle
  auctionDuration: 30, // slots
};

await driftClient.placePerpOrder(orderParams);
```

### Instruction Builders (Advanced)

Use ix builders when you need custom compute budgets, ALT usage, or batching.

<SDKDoc>
  <TypeScript name="getPlacePerpOrderIx" type="method" owner="DriftClient">
```js
const ix = await driftClient.getPlacePerpOrderIx(orderParams);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getPlaceSpotOrderIx" type="method" owner="DriftClient">
```js
const ix = await driftClient.getPlaceSpotOrderIx(orderParams);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getCancelOrdersIx" type="method" owner="DriftClient">
```js
const ix = await driftClient.getCancelOrdersIx(marketType, marketIndex, direction);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getFillPerpOrderIx" type="method" owner="DriftClient">
```js
const ix = await driftClient.getFillPerpOrderIx(userAccountPublicKey, userAccount, order, makerInfos);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getFillSpotOrderIx" type="method" owner="DriftClient">
```js
const ix = await driftClient.getFillSpotOrderIx(userAccountPublicKey, userAccount, order, makerInfos);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getTriggerOrderIx" type="method" owner="DriftClient">
```js
const ix = await driftClient.getTriggerOrderIx(userAccountPublicKey, userAccount, order);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getRevertFillIx" type="method" owner="DriftClient">
```js
const ix = await driftClient.getRevertFillIx();
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getSettlePNLsIxs" type="method" owner="DriftClient">
```js
const ixs = await driftClient.getSettlePNLsIxs(userAccountPublicKey, marketIndexes);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getJupiterSwapIxV6" type="method" owner="DriftClient">
```js
const ix = await driftClient.getJupiterSwapIxV6({
  inMarketIndex: 0,
  outMarketIndex: 1,
  amount: driftClient.convertToSpotPrecision(0, 10),
  slippageBps: 50,
});
```
  </TypeScript>
</SDKDoc>
### Place a Spot Order

<SDKDoc>
  <TypeScript name="placeSpotOrder" type="method" owner="DriftClient">
```js
import { OrderType, PositionDirection } from "@drift-labs/sdk";

await driftClient.placeSpotOrder({
  orderType: OrderType.LIMIT,
  marketIndex: 1, // e.g. SOL spot
  direction: PositionDirection.LONG,
  baseAssetAmount: driftClient.convertToSpotPrecision(1, 1), // 1 SOL
  price: driftClient.convertToPricePrecision(150),
});
```
  </TypeScript>
</SDKDoc>

### Place Multiple Orders

<SDKDoc>
  <TypeScript name="placeOrders" type="method" owner="DriftClient">
```js
await driftClient.placeOrders([
  {
    orderType: OrderType.LIMIT,
    marketType: MarketType.PERP,
    marketIndex: 0,
    direction: PositionDirection.LONG,
    baseAssetAmount: driftClient.convertToPerpPrecision(1),
    price: driftClient.convertToPricePrecision(21.23),
  },
  {
    orderType: OrderType.LIMIT,
    marketType: MarketType.PERP,
    marketIndex: 0,
    direction: PositionDirection.SHORT,
    baseAssetAmount: driftClient.convertToPerpPrecision(1),
    oraclePriceOffset: driftClient.convertToPricePrecision(0.05).toNumber(),
  },
]);
```
  </TypeScript>
</SDKDoc>

### Cancel Orders

<SDKDoc>
  <TypeScript name="cancelOrder" type="method" owner="DriftClient">
```js
await driftClient.cancelOrder(1);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="cancelOrdersByIds" type="method" owner="DriftClient">
```js
await driftClient.cancelOrdersByIds([1]);
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="cancelOrders" type="method" owner="DriftClient">
```js
import { MarketType, PositionDirection } from "@drift-labs/sdk";

// Cancels orders matching the filters. To cancel all orders, omit parameters.
await driftClient.cancelOrders(MarketType.PERP, 0, PositionDirection.LONG);
```
  </TypeScript>
</SDKDoc>

### Cancel and Place (Atomic)

<SDKDoc>
  <TypeScript name="cancelAndPlaceOrders" type="method" owner="DriftClient">
```js
await driftClient.cancelAndPlaceOrders(
  { marketType: MarketType.PERP, marketIndex: 0 },
  [
    {
      orderType: OrderType.LIMIT,
      marketIndex: 0,
      direction: PositionDirection.LONG,
      baseAssetAmount: driftClient.convertToPerpPrecision(1),
      price: driftClient.convertToPricePrecision(21.23),
    },
  ]
);
```
  </TypeScript>
</SDKDoc>

### Modify Orders

<SDKDoc>
  <TypeScript name="modifyOrder" type="method" owner="DriftClient">
```js
await driftClient.modifyOrder({
  orderId: 1,
  newBaseAmount: driftClient.convertToPerpPrecision(2),
});
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="modifyOrderByUserOrderId" type="method" owner="DriftClient">
```js
await driftClient.modifyOrderByUserOrderId({
  userOrderId: 1,
  newBaseAmount: driftClient.convertToPerpPrecision(2),
});
```
  </TypeScript>
</SDKDoc>

### Trigger Orders (Stop / Take-Profit)

```js
import { OrderTriggerCondition, OrderType, PositionDirection } from "@drift-labs/sdk";

const orderParams = {
  orderType: OrderType.TRIGGER_MARKET,
  marketIndex: 0,
  direction: PositionDirection.SHORT,
  baseAssetAmount: driftClient.convertToPerpPrecision(1),
  triggerPrice: driftClient.convertToPricePrecision(95),
  triggerCondition: OrderTriggerCondition.BELOW,
};

await driftClient.placePerpOrder(orderParams);
```

