# PnL & Risk

## How it works

Drift calculates your account's risk using a **health** metric that compares your total collateral (deposits minus borrows, plus unrealized perp PnL) against your margin requirements. Health = Total Collateral / Margin Requirement. When health drops below 1.0, your account becomes eligible for liquidation. Health above 1.0 means you're safe.

**PnL** (Profit and Loss) comes in two forms: **unrealized** (mark-to-market value of open positions) and **realized** (settled when positions close). Unrealized PnL is calculated by comparing your position's entry price to the current oracle price. For perps, you also have **funding PnL** from periodic funding rate payments between longs and shorts.

**Free collateral** is the amount of collateral not currently backing positions, it's what you can withdraw or use to open new positions. Margin requirements increase with position size and vary by market. Leverage is calculated as notional position value divided by total collateral. These metrics update in real-time as prices and positions change.

## SDK Usage

These helpers are commonly used for risk checks, dashboards, and liquidation logic.

### User health

<SDKDoc>
  <TypeScript name="getHealth" type="method" owner="User">
```js
const user = driftClient.getUser();
const health = user.getHealth();
console.log(health.toString());
```
  </TypeScript>
</SDKDoc>

### Collateral, margin requirement, leverage

<SDKDoc>
  <TypeScript name="getTotalCollateral" type="method" owner="User">
```js
const total = driftClient.getUser().getTotalCollateral();
console.log(total.toString());
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getMarginRequirement" type="method" owner="User">
```js
const req = driftClient.getUser().getMarginRequirement();
console.log(req.toString());
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getFreeCollateral" type="method" owner="User">
```js
const free = driftClient.getUser().getFreeCollateral();
console.log(free.toString());
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getLeverage" type="method" owner="User">
```js
const lev = driftClient.getUser().getLeverage();
console.log(lev.toString());
```
  </TypeScript>
</SDKDoc>

### Unrealized PnL

<SDKDoc>
  <TypeScript name="getUnrealizedPNL" type="method" owner="User">
```js
const pnl = driftClient.getUser().getUnrealizedPNL();
console.log(pnl.toString());
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="getUnrealizedFundingPNL" type="method" owner="User">
```js
const pnl = driftClient.getUser().getUnrealizedFundingPNL();
console.log(pnl.toString());
```
  </TypeScript>
</SDKDoc>

### Entry price helper

<SDKDoc>
  <TypeScript name="calculateEntryPrice" type="function">
```js
import { calculateEntryPrice } from "@drift-labs/sdk";

const position = driftClient.getUser().getPerpPosition(0);
if (position) {
  const entryPrice = calculateEntryPrice(position);
  console.log(entryPrice.toString());
}
```
  </TypeScript>
</SDKDoc>

### Settle perp PnL

<SDKDoc>
  <TypeScript name="settlePNL" type="method" owner="DriftClient">
```js
const user = driftClient.getUser();
await driftClient.settlePNL(user.userAccountPublicKey, user.getUserAccount(), 0);
```
  </TypeScript>
</SDKDoc>

