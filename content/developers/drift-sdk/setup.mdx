# Setup

The examples below use placeholders like `<RPC_URL>` and `<KEYPAIR_PATH>`.

### Program Addresses

The Drift program id is environment-specific. In most cases youâ€™ll use the default program id baked into the SDK config for `devnet` or `mainnet-beta`.

### Wallet / Authentication

To interact with Solana you need a keypair. One common approach for bots is to point `ANCHOR_WALLET` (or your own env var) at a JSON keypair file.

```bash
solana-keygen new --outfile ~/.config/solana/my-keypair.json
export ANCHOR_WALLET=~/.config/solana/my-keypair.json
```

### Install

```bash
npm i @drift-labs/sdk
```

### Create a Drift Client

At a minimum you provide a Solana `connection`, a `wallet`, and the `env`. Then call `subscribe()` to start receiving account updates.

```js
import { Connection } from "@solana/web3.js";
import { DriftClient, Wallet, loadKeypair } from "@drift-labs/sdk";

const connection = new Connection("<RPC_URL>", "confirmed");
const wallet = new Wallet(loadKeypair("<KEYPAIR_PATH>"));

const driftClient = new DriftClient({
  connection,
  wallet,
  env: "mainnet-beta",
});

await driftClient.subscribe();
```
  </TypeScript>
  <Rust name="drift_rs::DriftClient">
```rust
use drift_rs::{AccountFilter, DriftClient, Wallet, grpc::GrpcSubscribeOpts};
use solana_sdk::signature::Keypair;

async fn main() {
    let client = DriftClient::new(
        Context::MainNet,
        RpcClient::new("https://rpc-provider.com"),
        Keypair::new().into(),
    )
    .await
    .expect("connects");
}
```
  </Rust>
</SDKDoc>

<SDKDoc>
  <TypeScript name="subscribe" type="method" owner="DriftClient">
```js
await driftClient.subscribe();
```
  </TypeScript>

  <Rust name="subscribe" type="method" owner="DriftGrpcClient">
```rust
    // Subscribe via WebSocket
    //
    // 1) Ws-based live market and price changes
    let markets = [MarketId::spot(1), MarketId::perp(0)];
    client.subscribe_markets(&markets).await.unwrap();
    client.subscribe_oracles(&markets).await.unwrap();
    client.subscribe_account("SUBACCOUNT_1");

    // OR 2) subscribe via gRPC (advanced)
    // gRPC automatically subscribes to all markets and oracles
    client.grpc_subscribe(
      "https://grpc.example.com".into(),
      "API-X-TOKEN".into(),
      GrpcSubscribeOpts::default()
        .user_accounts("SUBACCOUNT_1", "SUB_ACCOUNT_2")
        .on_slot(move |new_slot| {
          // do something on slot
        })
        .on_account(
          AccountFilter::partial().with_discriminator(User::DISCRIMINATOR),
          move |account| {
              // do something on user account updates
          })
    ).await;
```
  </Rust>
</SDKDoc>

```js
await driftClient.unsubscribe();
```

### Account Subscriptions (WebSocket vs Polling)

For most bots, websocket subscriptions are the easiest way to keep markets and users up to date. For read-only workflows or when you need tighter control over RPC load, you can switch to polling with a `BulkAccountLoader`.

<details>
<summary>View BulkAccountLoader import</summary>

<SDKDoc>
  <TypeScript name="BulkAccountLoader" type="class">
```js
import { BulkAccountLoader } from "@drift-labs/sdk";
```
  </TypeScript>
</SDKDoc>

</details>

<SDKDoc>
  <TypeScript name="Polling subscription" type="example">
```js
import { BulkAccountLoader } from "@drift-labs/sdk";

const accountLoader = new BulkAccountLoader(connection, "confirmed", 0);

const driftClient = new DriftClient({
  connection,
  wallet,
  env: "mainnet-beta",
  accountSubscription: {
    type: "polling",
    accountLoader,
  },
  // Optional: explicitly list markets/oracles to load.
  // perpMarketIndexes: [0, 1],
  // spotMarketIndexes: [0],
  // oracleInfos: [{ publicKey: ORACLE_PUBKEY, source: ORACLE_SOURCE }],
});
```
  </TypeScript>
</SDKDoc>

### Multiple Subaccounts

<SDKDoc>
  <TypeScript name="hasUser" type="method" owner="DriftClient">
```js
if (!driftClient.hasUser(1)) {
  await driftClient.addUser(1);
}
```
  </TypeScript>
</SDKDoc>

<SDKDoc>
  <TypeScript name="addUser" type="method" owner="DriftClient">
```js
await driftClient.addUser(1);
```
  </TypeScript>
</SDKDoc>

### Program ID
```js
import { DRIFT_PROGRAM_ID } from "@drift-labs/sdk";

// The Drift program's public key on mainnet-beta.
// Use this when deriving PDAs or referencing the program directly.
console.log(DRIFT_PROGRAM_ID.toBase58());
```

### High Leverage Mode
```js
import { getHighLeverageModeConfigPublicKey } from "@drift-labs/sdk";

const pda = getHighLeverageModeConfigPublicKey(driftClient.program.programId);
const config = await driftClient.program.account.highLeverageModeConfig.fetch(pda);
```

